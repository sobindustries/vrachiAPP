# Платформа для онлайн-консультаций с врачами

**Версия: 1.0.2**

## Описание проекта

Платформа для онлайн-консультаций с врачами - это программный комплекс, предназначенный для связи пациентов с медицинскими специалистами. Система позволяет пользователям (пациентам) находить врачей по специализации и району, просматривать их профили, оплачивать консультацию и общаться с выбранным врачом в защищенном чате. Врачи могут использовать платформу как дополнительный канал для проведения консультаций и заработка.

Текущая версия проекта сосредоточена на базовом функционале веб-приложения и бэкенда, включая:

*   Регистрация пользователя с подтверждением email через SMTP (Gmail или другой SMTP-сервер).
*   Аутентификация по email/паролю с выдачей JWT токена.
*   Управление профилями Пациентов и Врачей (просмотр и редактирование).
*   Современный UI на основе библиотеки NextUI.
*   Выпадающее меню пользователя в правом верхнем углу для доступа к настройкам профиля и выходу.

## Технологический стек

Проект разработан с использованием следующих технологий:

*   **Бэкенд:** Python (FastAPI), SQLAlchemy (ORM), PyMySQL (драйвер БД), Alembic (миграции БД), Passlib (хеширование паролей), python-jose (JWT), python-dotenv (переменные окружения), smtplib (отправка email).
*   **Фронтенд (Web):** React, Vite, SASS (для общих стилей), NextUI (готовые UI компоненты), React Router (роутинг), Axios (HTTP-клиент), Zustand (управление состоянием).
*   **База данных:** MySQL/MariaDB.
*   **Контейнеризация (для локальной разработки и развертывания):** Docker, Docker Compose.

## Установка и запуск (с использованием Docker Compose - Рекомендуемый способ)

**Этот способ запускает базу данных и бэкенд в контейнерах Docker.** Это обеспечивает наиболее стабильное и воспроизводимое окружение.

1.  **Установите Docker и Docker Compose V2** в вашей системе, если они еще не установлены. Инструкции можно найти на официальном сайте Docker.
2.  **Клонируйте репозиторий:**
    ```bash
    https://github.com/scrollDynasty/vrachiAPP
    cd vrachiAPP
    ```

3.  **Настройте переменные окружения:**
    *   В корневой директории проекта находится файл `.env` (он игнорируется Git из соображений безопасности). Если его нет, создайте его: `touch .env`.
    *   Откройте файл `.env` и добавьте следующие переменные. **Обязательно замените значения на свои надежные данные!**
        ```env
        # Переменные окружения для Docker Compose и бэкенда
        # Используются в docker-compose.yml и в коде бэкенда

        # Настройки базы данных MySQL/MariaDB (для Docker контейнера db)
        MYSQL_ROOT_PASSWORD=ВАШ_ОЧЕНЬ_НАДЕЖНЫЙ_РУТ_ПАРОЛЬ # Пароль для root пользователя БД в контейнере
        MYSQL_DATABASE=online_doctors_db                 # Имя базы данных
        MYSQL_USER=vrachi_user                           # Имя пользователя для приложения
        MYSQL_PASSWORD=ВАШ_НАДЕЖНЫЙ_ПАРОЛЬ_БЕЗ_СОБАК_И_ДОЛЛАРОВ # Пароль для пользователя приложения. Убедитесь, что он без символов '@' и '$' для совместимости.

        # Секретный ключ для подписи JWT токенов (используется бэкендом)
        SECRET_KEY="ВАШ_СУПЕР_СЕКРЕТНЫЙ_КЛЮЧ_ДЛЯ_JWT" # Используйте длинную случайную строку! Обязательно в кавычках!

        # Базовый URL для подтверждения email на фронтенде (используется бэкендом для генерации ссылки подтверждения)
        # В разработке обычно http://localhost:порт_фронтенда/verify-email
        VERIFICATION_BASE_URL="http://localhost:5173/verify-email" # Убедитесь, что порт соответствует порту запуска фронтенда (по умолчанию 5173)

        # Строка подключения к БД для бэкенда, когда он в Docker контейнере.
        # Хост 'db' - это имя сервиса базы данных в сети Docker Compose.
        DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@db:3306/${MYSQL_DATABASE}
        
        # Настройки почтового сервера для отправки писем подтверждения
        # ВАЖНО: Для Gmail требуется создать пароль приложения, а не использовать обычный пароль аккаунта
        # Для создания пароля приложения:
        # 1. Включите двухфакторную аутентификацию в настройках аккаунта Google
        # 2. Перейдите в настройки безопасности аккаунта Google -> Пароли приложений
        # 3. Создайте новый пароль приложения и используйте его в EMAIL_PASSWORD
        EMAIL_HOST=smtp.gmail.com
        EMAIL_PORT=587
        EMAIL_USERNAME=your_email@gmail.com
        EMAIL_PASSWORD=your_app_password
        EMAIL_FROM=your_email@gmail.com
        ```
    *   **ВНИМАНИЕ:** Значение `DATABASE_URL` здесь использует переменные `${MYSQL_USER}` и `${MYSQL_PASSWORD}` из этого же файла. Docker Compose автоматически подставит их при запуске контейнеров. Убедитесь, что `MYSQL_USER` и `MYSQL_PASSWORD` определены ВЫШЕ в файле.
    *   **ВАЖНО О EMAIL:** При использовании Gmail для отправки писем необходимо создать специальный "пароль приложения", так как обычный пароль аккаунта не будет работать из-за политик безопасности. В продакшене рекомендуется использовать специализированные сервисы отправки email, такие как SendGrid, Mailgun или Amazon SES.
    *   Сохраните и закройте файл `.env`.

4.  **Выполните миграции базы данных:**
    После успешного запуска контейнеров, выполните миграции Alembic, чтобы создать или обновить структуру таблиц в базе данных внутри контейнера БД.
    Убедитесь, что вы находитесь в корневой директории проекта (`med-consult-platform/`).
    ```bash
    sudo docker compose exec backend_app alembic upgrade head
    ```
    *   `sudo docker compose exec backend_app`: Выполнить команду внутри запущенного контейнера с именем `backend_app` (имя сервиса бэкенда в `docker-compose.yml`).
    *   `alembic upgrade head`: Команда Alembic для применения всех непримененных миграций.

5.  **Установите зависимости фронтенда и запустите фронтенд:**
    Откройте **новый терминал** и перейдите в директорию фронтенда:
    ```bash
    cd frontend/
    ```
    Установите зависимости Node.js (если еще не сделали):
    ```bash
    npm install
    ```
    Запустите сервер разработки фронтенда:
    ```bash
    npm run dev
    ```

6.  **Откройте приложение в браузере:**
    Фронтенд будет доступен по адресу, который покажет Vite в консоли (обычно `http://localhost:5173/`).

## Установка и запуск (Локально - без Docker Compose)

Этот способ требует ручной установки и настройки базы данных и зависимостей Python в вашей операционной системе.

1.  **Установите MySQL/MariaDB сервер** в вашей системе (например, `sudo apt install mariadb-server` для Kali/Debian) и убедитесь, что сервис запущен (`sudo systemctl status mariadb`).
2.  **Подключитесь к серверу БД** (например, `sudo mysql -u root -p`) и **создайте базу данных** (`CREATE DATABASE online_doctors_db ...`) и **пользователя** (`CREATE USER 'vrachi_user'@'localhost' ... IDENTIFIED BY 'ВАШ_ПАРОЛЬ'`) с правами на эту базу (`GRANT ALL ...`).
3.  **Перейдите в директорию бэкенда:**
    ```bash
    cd backend/
    ```
4.  **Создайте и активируйте виртуальное окружение Python:**
    ```bash
    python -m venv venv
    source venv/bin/activate
    ```
5.  **Установите зависимости Python:**
    ```bash
    pip install -r requirements.txt
    ```
    Убедитесь, что файл `backend/requirements.txt` содержит все необходимые пакеты (fastapi, uvicorn, SQLAlchemy, PyMySQL, alembic, passlib[bcrypt], python-jose[cryptography], python-dotenv).
6.  **Настройте переменные окружения:**
    *   Создайте файл `.env` в директории `backend/`.
    *   Добавьте в него переменные `SECRET_KEY` и `VERIFICATION_BASE_URL` (как в примере для Docker Compose выше).
    *   **Измените строку подключения к базе данных** в файле `backend/models.py`. Найдите `DATABASE_URL` и измените хост на `localhost` и укажите правильные учетные данные вашей локальной БД:
        ```python
        # backend/models.py
        # ...
        DATABASE_URL = os.getenv("DATABASE_URL", "mysql+pymysql://vrachi_user:ВАШ_ПАРОЛЬ@localhost:3306/online_doctors_db") # <--- Используйте localhost и ВАШ ПАРОЛЬ
        # ...
        ```
        *Примечание: Если вы используете переменную окружения `DATABASE_URL` в вашем локальном `.env`, убедитесь, что она там указана правильно с `localhost`.*
7.  **Измените строку подключения Alembic:**
    *   Откройте файл `backend/alembic.ini`.
    *   Найдите строку `sqlalchemy.url` и измените хост на `localhost` и укажите правильные учетные данные вашей локальной БД:
        ```ini
        # alembic.ini
        # ...
        sqlalchemy.url = mysql+pymysql://vrachi_user:ВАШ_ПАРОЛЬ@localhost:3306/online_doctors_db # <--- Используйте localhost и ВАШ ПАРОЛЬ
        # ...
        ```
8.  **Выполните миграции Alembic локально:**
    Убедитесь, что вы в директории `backend/` с активным виртуальным окружением.
    ```bash
    alembic upgrade head
    ```
9.  **Запустите бэкенд локально:**
    Убедитесь, что вы в директории `backend/` с активным виртуальным окружением.
    ```bash
    uvicorn main:app --reload
    ```
10. **Запустите фронтенд локально:**
    Откройте **новый терминал** и перейдите в директорию фронтенда:
    ```bash
    cd frontend/
    ```
    Установите зависимости Node.js (если еще не сделали):
    ```bash
    npm install
    ```
    Запустите сервер разработки фронтенда:
    ```bash
    npm run dev
    ```
11. **Откройте приложение в браузере:** `http://localhost:5173/`

## Использование Приложения

(Этот раздел остался без изменений, описывает сценарий работы пользователя)

## Обновления в текущей версии (1.0.2)

*   Реализована реальная отправка писем для подтверждения email через SMTP-сервер (например, Gmail).
*   Заменена UI-библиотека на NextUI вместо старых кастомных компонентов.
*   Оптимизирован и очищен код фронтенда и бэкенда.
*   Исправлен стиль и улучшены формы регистрации и входа.
*   Улучшен интерфейс пользователя:
    * Исправлены проблемы с отступами и интервалами в формах
    * Добавлены фиксированные контейнеры для сообщений об ошибках
    * Внедрен единый стиль оформления для форм входа, регистрации и профиля
    * Переработана страница настроек профиля
    * Функция изменения пароля перенесена в модальное окно
    * Создан отдельный блок "подвала" для настроек аккаунта
    * Реализована функция загрузки фотографий профиля с сохранением в localStorage
    * Внедрена логика условного изменения пароля (разная для аккаунтов Google и обычных)
    * Уменьшены размеры шрифтов и элементов для более компактного вида
    * Заменены прямоугольные блоки на карточки с закругленными углами
    * Добавлены иконки и визуальные индикаторы
    * Создана адаптивная сетка для опций настроек
    * Реализованы эффекты при наведении и единые отступы
    * Удалены дублирующиеся элементы интерфейса
    * Устранены избыточные секции настроек
    * Централизовано управление аккаунтом
*   Настроены файлы .gitignore для проекта с включением .env файлов в репозиторий
*   Удалены неиспользуемые компоненты (Button.jsx, Input.jsx)

## Обновления в предыдущей версии (1.0.1)

*   Реализована регистрация пользователя с подтверждением email (ссылка подтверждения выводится в консоль бэкенда).
*   Реализована аутентификация по email/паролю с использованием JWT. Логин доступен только для пользователей с подтвержденным email.
*   Реализованы эндпоинты API для управления профилями Пациентов и Врачей (создание/редактирование/получение).
*   Фронтенд интегрирован с бэкендом для процессов регистрации, подтверждения email и аутентификации.
*   Внедрена UI-библиотека Material UI для улучшения внешнего вида фронтенда.
*   Корневой маршрут `/` теперь служит точкой входа для неавторизованных пользователей, отображая объединенную страницу Входа/Регистрации.
*   Реализовано выпадающее меню пользователя в правом верхнем углу для авторизованных пользователей с пунктом "Настройки Профиля" и "Выход".
*   Исправлено перенаправление при выходе пользователя.
*   Страница профиля переименована в "Настройки Профиля" и настроена для работы с компонентами форм MUI.

## TODO (Предстоящие задачи)

*   ✓ ~~Реальная отправка писем для подтверждения email.~~ (Реализовано в v1.0.2)
*   Доработка форм профилей Врача (выбор специализаций и районов из списков, опыт в годах, образование).
*   Реализация эндпоинтов бэкенда для получения списков специализаций и районов.
*   Реализация поиска врачей по специализации и району.
*   Модуль онлайн-чата (бэкенд с WebSockets и фронтенд).
*   Интеграция платежной системы.
*   Модуль отзывов и рейтингов.
*   Просмотр истории консультаций и платежей.
*   Административная панель (верификация врачей, управление пользователями).
*   Функционал восстановления пароля.
*   Улучшение UI/UX и адаптивности на всех страницах.
*   Написание тестов.
*   Подготовка к продакшен развертыванию (Dockerfile для продакшена, настройка сервера).

## Вклад в разработку

(Раздел для описания процесса внесения изменений, создания веток, пулл-реквестов, если проект открытый)

## Лицензия

(Информация о лицензии проекта, например MIT)

Project Under Development
---
